language: go
go:
  - 1.x
sudo: false
before_script:
  - go vet ./...
  - go test -race ./...
script:
  - go build -i -race -o bin/ephemeral-roles ephemeral-roles.go
before_deploy:
  - zip -r ephemeral-roles.zip .
deploy:
  provider: elasticbeanstalk
  skip_cleanup: true
  region: "us-east-1"
  access_key_id: $ACCESSKEYID
  secret_access_key:
    secure: "$SECRETACCESSKEY"
  zip_file: ephemeral-roles.zip
  app: ephemeral-roles
  env: ephemeral-roles
  bucket_name: ephemeral-roles
  wait-until-deployed: true
  on:
    repo: ewohltman/ephemeral-roles
    all_branches: true